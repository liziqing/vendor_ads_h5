define(["wx","base/env","base/wx","base/util","jquery","swiper"],function(a,e,n,o,t,i){t(function(){function a(){var a=document.getElementById("userfile"),e=document.getElementById("preview-box");return a.files&&a.files[0]&&t(e).attr("src",window.URL.createObjectURL(a.files[0])),!0}function n(a,n,o){t.ajax({type:"POST",url:"http://"+e.apidomain+"/kangshifu/image-up",data:{type:a,mobile:n,url:o},dataType:"json",success:function(a){console.log(localStorage)},error:function(a){console.log("ajaxFailure")}})}var i="";console.log(localStorage),localStorage.mobile&&(i=localStorage.mobile);var r=t("#key"),l=t("#userfile"),s="",c="http://vendor-ads.cdnqiniu02.qnmami.com/";!function(){t.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/qn-token",data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){0==a.code&&t('input[name="token"]').val(a.data.token)},error:function(a){console.log("ajaxFailure")}})}(),function(){t.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/image-list?type=2",data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){if(0==a.code)for(var e=0;e<a.data.list.length;e++)t("#wall").append('<img src="'+a.data.list[e]+'">')},error:function(a){console.log("ajaxFailure")}})}(),t("#userfile").change(function(){t(".mask").hide(),t(".upload-mask").show(),a()}),t("#upload").click(function(){if(!l.val())return!1;var a=Math.random().toString(36).substr(2)+l.val().match(/\.?[^.\/]+$/);r.val(a);var e=new FormData(document.getElementById("upform"));return t.ajax({url:"http://upload.qiniu.com/",type:"POST",data:e,processData:!1,contentType:!1,xhr:function(){return myXhr=t.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(a){if(a.lengthComputable){a.loaded,a.total}},!1),myXhr},success:function(a){var e="<span>已上传："+a.key+"</span>";e+='<img src="'+c+a.key+'"/>',console.log(c+a.key),s=c+a.key,i?(n(2,i,s),t(".mask").hide(),t(".share-mask").fadeIn()):(t(".mask").hide(),t(".tel-mask").fadeIn())},error:function(a){console.log("失败:"+JSON.stringify(a))}}),!1}),t("#submit").click(function(){var a=t("#telephone").val().trim();o.isMobile(a)&&(localStorage.setItem("mobile",a),n(2,a,s),t(".mask").hide(),t(".share-mask").fadeIn())}),t(".share-btn").click(function(){t(".weui_mask").fadeIn(),t.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/have-share?mobile="+i,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){a.code},error:function(a){console.log("ajaxFailure")}})}),t(".weui_mask").click(function(){t(this).fadeOut()})})});