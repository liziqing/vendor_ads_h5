define(["wx","base/env","base/wx","base/util","jquery","swiper"],function(a,o,e,t,n,r){n(function(){function a(){var a=document.getElementById("userfile"),o=document.getElementById("preview-box");return a.files&&a.files[0]&&n(o).attr("src",window.URL.createObjectURL(a.files[0])),!0}function e(a,e,t){n.ajax({type:"GET",url:"http://"+o.apidomain+"/kangshifu/image-up",data:{type:a,mobile:e,url:t,random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){console.log(localStorage),n(".mask").hide(),n(".share-mask").fadeIn()},error:function(a){console.log("ajaxFailure")}})}var r="",i=!0;console.log(localStorage),localStorage.mobile&&(r=localStorage.mobile),localStorage.actor?1==localStorage.actor?n(".actor").show().attr("src","./img/lyf_cover.png"):2==localStorage.actor?n(".actor").show().attr("src","./img/wl_cover.png"):n(".actor").hide():n(".actor").hide();var c=n("#key"),l=n("#userfile"),s="",u="http://vendor-ads.cdnqiniu02.qnmami.com/";!function(){n.ajax({type:"GET",url:"http://"+o.apidomain+"/kangshifu/qn-token",data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){0==a.code&&n('input[name="token"]').val(a.data.token)},error:function(a){console.log("ajaxFailure")}})}(),function(){n.ajax({type:"GET",url:"http://"+o.apidomain+"/kangshifu/image-list?type=2",data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){if(0==a.code)for(var o=0;o<a.data.list.length;o++)n("#wall").append('<img src="'+a.data.list[o]+'">')},error:function(a){console.log("ajaxFailure")}})}(),function(){n.ajax({type:"GET",url:"http://"+o.apidomain+"/kangshifu/image-list?type=1&mobile="+r,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){if(0==a.code&&0==a.data.list.length)return void(i=!1)},error:function(a){console.log("ajaxFailure")}})}(),n("#userfile").change(function(){n(".mask").hide(),n(".upload-mask").show(),a(),setTimeout(function(){n(".preview-box-cover").css({width:n("#preview-box").css("width"),height:n("#preview-box").css("height")})},100)}),n("#upload").click(function(){if(!l.val())return!1;var a=Math.random().toString(36).substr(2)+l.val().match(/\.?[^.\/]+$/);c.val(a);var o=new FormData(document.getElementById("upform"));return n.ajax({url:"http://upload.qiniu.com/",type:"POST",data:o,processData:!1,contentType:!1,xhr:function(){return myXhr=n.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(a){if(a.lengthComputable){a.loaded,a.total}},!1),myXhr},success:function(a){var o="<span>已上传："+a.key+"</span>";o+='<img src="'+u+a.key+'"/>',console.log(u+a.key),s=u+a.key,r?e(2,r,s):(n(".mask").hide(),n(".tel-mask").fadeIn())},error:function(a){console.log("失败:"+JSON.stringify(a))}}),!1}),n("#submit").click(function(){var a=n("#telephone").val().trim();t.isMobile(a)&&(localStorage.setItem("mobile",a),e(2,a,s))}),n("#myUp").click(function(){i?window.location.href="./album.html":t.alerty("您还没有上传照片，先去拍一张吧！")}),n(".share-btn").click(function(){n(".weui_mask").fadeIn(),n.ajax({type:"GET",url:"http://"+o.apidomain+"/kangshifu/have-share?mobile="+r,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){a.code},error:function(a){console.log("ajaxFailure")}})}),n(".weui_mask").click(function(){n(this).fadeOut()})})});