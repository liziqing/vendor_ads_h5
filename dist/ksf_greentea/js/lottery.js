define(["wx","base/env","base/wx","base/util","jquery","swiper"],function(e,t,n,a,i,o){i(function(){function o(){return b.times+=1,b.roll(),b.times>b.cycle+10&&b.prize==b.index?(clearTimeout(b.timer),b.prize=-1,b.times=0,g=!1,r(u),setTimeout(function(){i(".tel-mask").fadeIn()},1e3)):(b.times<b.cycle?b.speed-=10:b.times==b.cycle?b.prize=m:b.times>b.cycle+10&&(0==b.prize&&7==b.index||b.prize==b.index+1)?b.speed+=110:b.speed+=20,b.speed<40&&(b.speed=40),b.timer=setTimeout(o,b.speed)),!1}function s(){i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/huo-li?mobile="+c,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){0==e.code&&(i("#score").text(e.data.value),i("#count").text(parseInt(i("#score").text()/72)))},error:function(e){console.log("ajaxFailure")}})}function r(e){var t="";if(4==e)i(".tel-mask").html('<h3>再次续活力</h3>\n<div class="telephone-box">\n    <div class="prize-box">\n        <p>再接再厉！好运就来</p>\n        <div><div class="btn buy-btn" onclick="window.location.href=\'https://item.m.jd.com/product/2798826.html\'">电商购买</div></div>\n        <div class="btn share-btn"  style="width: 2.2rem;">拉帮结派</div> <div class="btn return-btn" onclick="window.location.href=\'./lottery.html\'" style="width: 2.2rem;">返 回</div>\n    </div>\n</div>\n<img src="./img/twins.png" class="twins">\n\n');else{switch(e){case 1:case 2:t="请输入您的手机号<br>以确保您的入场券顺利到达~";break;case 3:t="请输入您的手机号<br>以确保您当天观看顺利登入"}i("#prizeText").html(t),i("#prizeImg").attr("src","./img/prize_"+e+".png")}}function l(){n.initWxJs("wx8e56a8ebb0688ab9","pt_christmas",["onMenuShareTimeline","onMenuShareAppMessage"],function(){e.onMenuShareTimeline({title:y.shareTitle,link:y.shareUrl,imgUrl:y.shareImg,success:function(){},cancel:function(){}}),e.onMenuShareAppMessage({title:y.shareTitle,link:y.shareUrl,desc:y.shareDes,imgUrl:y.shareImg,type:"",dataUrl:"",success:function(){},cancel:function(){}})})}var c="";console.log(localStorage),localStorage.mobile&&(c=localStorage.mobile),i("#telephone").val(c),s(),function(){i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/lottery-result?mobile="+c,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){function t(e,t){-1!=e.indexOf(t)&&i("#prizeList").append('<img src="./img/prize_'+t+'.png" class="prize'+t+'">')}if(0==e.code){var n=e.data.list;t(n,"1"),t(n,"2"),t(n,"3")}},error:function(e){console.log("ajaxFailure")}})}();var u=3,m=0,d=[6],p=[2],h=[0,4],f=[1,3,5,7],g=!1,b={index:0,count:0,timer:0,speed:200,times:0,cycle:50,prize:4,init:function(e){i("#"+e).find(".lottery-unit").length>0&&($lottery=i("#"+e),$units=$lottery.find(".lottery-unit"),this.obj=$lottery,this.count=$units.length,$lottery.find(".lottery-unit-"+this.index).addClass("active"))},roll:function(){var e=this.index,t=this.count,n=this.obj;return i(n).find(".lottery-unit-"+e).removeClass("active"),e+=1,e>t-1&&(e=0),i(n).find(".lottery-unit-"+e).addClass("active"),this.index=e,!1},stop:function(e){return this.prize=e,!1}};b.init("lottery"),i("#lottery a").click(function(){if(g)return!1;parseInt(i("#count").text())>0?i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/lottery?mobile="+c,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){if(0==e.code){switch(s(),u=parseInt(e.data.result),console.log("奖项："+u),u){case 1:m=d[Math.floor(Math.random()*d.length)],y.shareDes="开心，我有李易峰610（李易峰吴磊624）的门票一张！你也来试试吧～",l();break;case 2:m=p[Math.floor(Math.random()*p.length)],y.shareDes="开心，我有李易峰610（李易峰吴磊624）的门票一张！你也来试试吧～",l();break;case 3:m=h[Math.floor(Math.random()*h.length)],y.shareDes="开心，我有李易峰吴磊6·24见面会爱奇艺特殊角度观看劵了！你也来试试吧～",l();break;case 4:m=f[Math.floor(Math.random()*f.length)],y.shareDes="给我活力，好想要李易峰x吴磊生日会门票><一回生二回熟，下次一定活力满满有好运！！",l()}return b.speed=100,o(),g=!0,!1}},error:function(e){console.log("ajaxFailure")}}):a.alerty("活力值不足，不能抽奖")}),i("#submit").click(function(){i("#fullname").val().trim()?a.isMobile(i("#telephone").val().trim())&&i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/up-user-info",data:{name:i("#fullname").val().trim(),mobile:i("#telephone").val().trim(),random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){console.log(localStorage),i(".mask").hide(),i(".share-mask").fadeIn()},error:function(e){console.log("ajaxFailure")}}):a.alerty("请输入姓名")}),i(".prize-btn").click(function(){i(".prize-mask").fadeIn()}),i(document).on("click",".share-btn",function(){i(".weui_mask").fadeIn(),i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/have-share?mobile="+c,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){e.code},error:function(e){console.log("ajaxFailure")}})}),i(".weui_mask").click(function(){i(this).fadeOut()}),i(document).on("click",".prize3",function(){});var y={shareTitle:"【康师傅绿茶健康活力派】",shareUrl:"http://kangshifu.qnmami.com",shareImg:"http://kangshifu.qnmami.com/img/slogan.png",shareDes:"给我活力，好想要李易峰x吴磊生日会门票><一回生二回熟，下次一定活力满满有好运！！"}})});