define(["wx","base/env","base/wx","base/util","jquery","swiper"],function(t,e,a,n,i,o){i(function(){function t(){return h.times+=1,h.roll(),h.times>h.cycle+10&&h.prize==h.index?(clearTimeout(h.timer),h.prize=-1,h.times=0,m=!1,o(s),setTimeout(function(){i(".tel-mask").fadeIn()},1e3)):(h.times<h.cycle?h.speed-=10:h.times==h.cycle?h.prize=l:h.times>h.cycle+10&&(0==h.prize&&7==h.index||h.prize==h.index+1)?h.speed+=110:h.speed+=20,h.speed<40&&(h.speed=40),h.timer=setTimeout(t,h.speed)),!1}function a(){i.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/huo-li?mobile="+r,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(t){0==t.code&&(i("#score").text(t.data.value),i("#count").text(parseInt(i("#score").text()/72)))},error:function(t){console.log("ajaxFailure")}})}function o(t){var e="";if(4==t)i(".tel-mask").html('<h3>再次续活力</h3>\n<div class="telephone-box">\n    <div class="prize-box">\n        <p>再接再厉！好运就来</p>\n        <div><div class="btn buy-btn" onclick="window.location.href=\'https://item.m.jd.com/product/2798826.html\'">电商购买</div></div>\n        <div class="btn share-btn"  style="width: 2.2rem;">拉帮结派</div> <div class="btn return-btn" onclick="window.location.href=\'./lottery.html\'" style="width: 2.2rem;">返 回</div>\n    </div>\n</div>\n<img src="./img/twins.png" class="twins">\n\n');else{switch(t){case 1:case 2:e="请输入您的手机号<br>以确保您的入场券顺利到达~";break;case 3:e="请输入您的手机号<br>以确保您当天观看顺利登入"}i("#prizeText").html(e),i("#prizeImg").attr("src","./img/prize_"+t+".png")}}var r="";console.log(localStorage),localStorage.mobile&&(r=localStorage.mobile),i("#telephone").val(r),a(),function(){i.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/lottery-result?mobile="+r,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(t){function e(t,e){-1!=t.indexOf(e)&&i("#prizeList").append('<img src="./img/prize_'+e+'.png">')}if(0==t.code){var a=t.data.list;e(a,"1"),e(a,"2"),e(a,"3")}},error:function(t){console.log("ajaxFailure")}})}();var s=3,l=0,c=[6],d=[2],u=[0,4],p=[1,3,5,7],m=!1,h={index:0,count:0,timer:0,speed:200,times:0,cycle:50,prize:4,init:function(t){i("#"+t).find(".lottery-unit").length>0&&($lottery=i("#"+t),$units=$lottery.find(".lottery-unit"),this.obj=$lottery,this.count=$units.length,$lottery.find(".lottery-unit-"+this.index).addClass("active"))},roll:function(){var t=this.index,e=this.count,a=this.obj;return i(a).find(".lottery-unit-"+t).removeClass("active"),t+=1,t>e-1&&(t=0),i(a).find(".lottery-unit-"+t).addClass("active"),this.index=t,!1},stop:function(t){return this.prize=t,!1}};h.init("lottery"),i("#lottery a").click(function(){if(m)return!1;parseInt(i("#count").text())>0?i.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/lottery?mobile="+r,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){if(0==e.code){switch(a(),s=parseInt(e.data.result),console.log("奖项："+s),s){case 1:l=c[Math.floor(Math.random()*c.length)];break;case 2:l=d[Math.floor(Math.random()*d.length)];break;case 3:l=u[Math.floor(Math.random()*u.length)];break;case 4:l=p[Math.floor(Math.random()*p.length)]}return h.speed=100,t(),m=!0,!1}},error:function(t){console.log("ajaxFailure")}}):n.alerty("活力值不足，不能抽奖")}),i("#submit").click(function(){i("#fullname").val().trim()?n.isMobile(i("#telephone").val().trim())&&i.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/up-user-info",data:{name:i("#fullname").val().trim(),mobile:i("#telephone").val().trim(),random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(t){console.log(localStorage),i(".mask").hide(),i(".share-mask").fadeIn()},error:function(t){console.log("ajaxFailure")}}):n.alerty("请输入姓名")}),i(".prize-btn").click(function(){i(".prize-mask").fadeIn()}),i(".share-btn").click(function(){i(".weui_mask").fadeIn(),i.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/have-share?mobile="+r,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(t){t.code},error:function(t){console.log("ajaxFailure")}})}),i(".weui_mask").click(function(){i(this).fadeOut()})})});