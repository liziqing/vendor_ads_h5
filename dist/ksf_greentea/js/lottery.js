define(["wx","base/env","base/wx","base/util","jquery","swiper"],function(e,t,n,a,i,o){i(function(){function o(){return g.times+=1,g.roll(),g.times>g.cycle+10&&g.prize==g.index?(clearTimeout(g.timer),g.prize=-1,g.times=0,f=!1,s(c),setTimeout(function(){i(".tel-mask").fadeIn()},1e3)):(g.times<g.cycle?g.speed-=10:g.times==g.cycle?g.prize=u:g.times>g.cycle+10&&(0==g.prize&&7==g.index||g.prize==g.index+1)?g.speed+=110:g.speed+=20,g.speed<40&&(g.speed=40),g.timer=setTimeout(o,g.speed)),!1}function r(){i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/huo-li?mobile="+l,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){0==e.code&&(i("#score").text(e.data.value),i("#count").text(parseInt(i("#score").text()/72)))},error:function(e){console.log("ajaxFailure")}})}function s(e){var t="";if(4==e)i(".tel-mask").html('<h3>再次续活力</h3>\n<div class="telephone-box">\n    <div class="prize-box">\n        <p>再接再厉！好运就来</p>\n        <div><div class="btn buy-btn" onclick="window.location.href=\'https://item.m.jd.com/product/2798826.html\'">电商购买</div></div>\n        <div class="btn share-btn"  style="width: 2.2rem;">拉帮结派</div> <div class="btn return-btn" onclick="window.location.href=\'./lottery.html\'" style="width: 2.2rem;">返 回</div>\n    </div>\n</div>\n<img src="./img/twins.png" class="twins">\n\n');else{switch(e){case 1:case 2:t="请输入您的手机号<br>以确保您的入场券顺利到达~";break;case 3:t="请输入您的手机号<br>以确保您当天观看顺利登入"}i("#prizeText").html(t),i("#prizeImg").attr("src","./img/prize_"+e+".png")}}var l="";console.log(localStorage),localStorage.mobile&&(l=localStorage.mobile),i("#telephone").val(l),r(),function(){i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/lottery-result?mobile="+l,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){function t(e,t){-1!=e.indexOf(t)&&i("#prizeList").append('<img src="./img/prize_'+t+'.png">')}if(0==e.code){var n=e.data.list;t(n,"1"),t(n,"2"),t(n,"3")}},error:function(e){console.log("ajaxFailure")}})}();var c=3,u=0,d=[6],m=[2],p=[0,4],h=[1,3,5,7],f=!1,g={index:0,count:0,timer:0,speed:200,times:0,cycle:50,prize:4,init:function(e){i("#"+e).find(".lottery-unit").length>0&&($lottery=i("#"+e),$units=$lottery.find(".lottery-unit"),this.obj=$lottery,this.count=$units.length,$lottery.find(".lottery-unit-"+this.index).addClass("active"))},roll:function(){var e=this.index,t=this.count,n=this.obj;return i(n).find(".lottery-unit-"+e).removeClass("active"),e+=1,e>t-1&&(e=0),i(n).find(".lottery-unit-"+e).addClass("active"),this.index=e,!1},stop:function(e){return this.prize=e,!1}};g.init("lottery"),i("#lottery a").click(function(){if(f)return!1;parseInt(i("#count").text())>0?i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/lottery?mobile="+l,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){if(0==e.code){switch(r(),c=parseInt(e.data.result),console.log("奖项："+c),c){case 1:u=d[Math.floor(Math.random()*d.length)];break;case 2:u=m[Math.floor(Math.random()*m.length)];break;case 3:u=p[Math.floor(Math.random()*p.length)];break;case 4:u=h[Math.floor(Math.random()*h.length)]}return g.speed=100,o(),f=!0,!1}},error:function(e){console.log("ajaxFailure")}}):a.alerty("活力值不足，不能抽奖")}),i("#submit").click(function(){i("#fullname").val().trim()?a.isMobile(i("#telephone").val().trim())&&i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/up-user-info",data:{name:i("#fullname").val().trim(),mobile:i("#telephone").val().trim(),random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){console.log(localStorage),i(".mask").hide(),i(".share-mask").fadeIn()},error:function(e){console.log("ajaxFailure")}}):a.alerty("请输入姓名")}),i(".prize-btn").click(function(){i(".prize-mask").fadeIn()}),i(".share-btn").click(function(){i(".weui_mask").fadeIn(),i.ajax({type:"GET",url:"http://"+t.apidomain+"/kangshifu/have-share?mobile="+l,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){e.code},error:function(e){console.log("ajaxFailure")}})}),i(".weui_mask").click(function(){i(this).fadeOut()});var b={shareTitle:"康师傅绿茶！",shareUrl:window.location.href,shareImg:"http://kangshifu.qnmami.com/img/slogan.png",shareDes:"康师傅绿茶！"};n.initWxJs("wx8e56a8ebb0688ab9","pt_christmas",["onMenuShareTimeline","onMenuShareAppMessage"],function(){e.onMenuShareTimeline({title:b.shareTitle,link:b.shareUrl,imgUrl:b.shareImg,success:function(){},cancel:function(){}}),e.onMenuShareAppMessage({title:b.shareTitle,link:b.shareUrl,desc:b.shareDes,imgUrl:b.shareImg,type:"",dataUrl:"",success:function(){},cancel:function(){}})})})});