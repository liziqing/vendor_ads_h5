define(["wx","base/env","base/wx","base/util","jquery","swiper","imgLoadCatch","fullpage"],function(a,e,n,t,o,i){o(function(){function i(){var a=document.getElementById("userfile"),e=document.getElementById("preview-box");return a.files&&a.files[0]&&o(e).attr("src",window.URL.createObjectURL(a.files[0])),!0}function s(a,n,t){o.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/image-up",data:{type:a,mobile:n,url:t,random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){console.log(localStorage),o(".mask").hide(),o(".share-mask").fadeIn()},error:function(a){console.log("ajaxFailure")}})}var r="";console.log(localStorage),localStorage.mobile&&(r=localStorage.mobile);var c=o("#key"),l=o("#userfile"),u="",m="http://vendor-ads.cdnqiniu02.qnmami.com/";!function(){o.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/qn-token",data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){0==a.code&&o('input[name="token"]').val(a.data.token)},error:function(a){console.log("ajaxFailure")}})}(),function(){o.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/verify-status",data:{mobile:r,random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){a.data.image&&(o(".mask").hide(),o(".verify-success").fadeIn())},error:function(a){console.log("ajaxFailure")}})}(),o("#userfile").change(function(){_hmt.push(["_trackEvent","choose-order-btn","click"]),o(".mask").hide(),o(".upload-mask").show(),i()}),o("#upload").click(function(){if(_hmt.push(["_trackEvent","upload-order-btn","click"]),!l.val())return!1;var a=Math.random().toString(36).substr(2)+l.val().match(/\.?[^.\/]+$/);c.val(a);var e=new FormData(document.getElementById("upform"));return o.ajax({url:"http://upload.qiniu.com/",type:"POST",data:e,processData:!1,contentType:!1,xhr:function(){return myXhr=o.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(a){if(a.lengthComputable){a.loaded,a.total;o(".loading-mask").show(),a.loaded==a.total&&o(".loading-mask").hide()}},!1),myXhr},success:function(a){var e="<span>已上传："+a.key+"</span>";e+='<img src="'+m+a.key+'"/>',console.log(m+a.key),u=m+a.key,r?s(1,r,u):(o(".mask").hide(),o(".tel-mask").fadeIn())},error:function(a){console.log("失败:"+JSON.stringify(a))}}),!1}),o("#submit").click(function(){_hmt.push(["_trackEvent","confirm-mobile-btn","click"]);var a=o("#telephone").val().trim();localStorage.setItem("mobile",a),t.isMobile(a)&&s(1,a,u)}),o(".share-btn").click(function(){_hmt.push(["_trackEvent","share-btn","click"]),o(".weui_mask").fadeIn(),o.ajax({type:"GET",url:"http://"+e.apidomain+"/kangshifu/have-share?mobile="+r,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(a){a.code},error:function(a){console.log("ajaxFailure")}})}),o(".weui_mask").click(function(){o(this).fadeOut()});var h={shareTitle:"【康师傅绿茶健康活力派】",shareUrl:"http://kangshifu.qnmami.com",shareImg:"http://kangshifu.qnmami.com/img/slogan.png",shareDes:"可以见峰峰和吴磊咯！赶紧一起京东下单一箱康师傅绿茶，有机会得到李易峰x吴磊见面会门票！"};n.initWxJs("wx8e56a8ebb0688ab9","pt_christmas",["onMenuShareTimeline","onMenuShareAppMessage"],function(){a.onMenuShareTimeline({title:h.shareTitle,link:h.shareUrl,imgUrl:h.shareImg,success:function(){},cancel:function(){}}),a.onMenuShareAppMessage({title:h.shareTitle,link:h.shareUrl,desc:h.shareDes,imgUrl:h.shareImg,type:"",dataUrl:"",success:function(){},cancel:function(){}})})})});