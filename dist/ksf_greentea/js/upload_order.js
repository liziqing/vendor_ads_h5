define(["wx","base/env","base/wx","base/util","jquery","swiper","imgLoadCatch","fullpage"],function(e,a,n,o,t,i){t(function(){function i(){var e=document.getElementById("userfile"),a=document.getElementById("preview-box");return e.files&&e.files[0]&&t(a).attr("src",window.URL.createObjectURL(e.files[0])),!0}function r(e,n,o){t.ajax({type:"GET",url:"http://"+a.apidomain+"/kangshifu/image-up",data:{type:e,mobile:n,url:o,random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){console.log(localStorage),t(".mask").hide(),t(".share-mask").fadeIn()},error:function(e){console.log("ajaxFailure")}})}var s="";console.log(localStorage),localStorage.mobile&&(s=localStorage.mobile);var l=t("#key"),c=t("#userfile"),u="",m="http://vendor-ads.cdnqiniu02.qnmami.com/";!function(){t.ajax({type:"GET",url:"http://"+a.apidomain+"/kangshifu/qn-token",data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){0==e.code&&t('input[name="token"]').val(e.data.token)},error:function(e){console.log("ajaxFailure")}})}(),t("#userfile").change(function(){t(".mask").hide(),t(".upload-mask").show(),i()}),t("#upload").click(function(){if(!c.val())return!1;var e=Math.random().toString(36).substr(2)+c.val().match(/\.?[^.\/]+$/);l.val(e);var a=new FormData(document.getElementById("upform"));return t.ajax({url:"http://upload.qiniu.com/",type:"POST",data:a,processData:!1,contentType:!1,xhr:function(){return myXhr=t.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(e){if(e.lengthComputable){e.loaded,e.total}},!1),myXhr},success:function(e){var a="<span>已上传："+e.key+"</span>";a+='<img src="'+m+e.key+'"/>',console.log(m+e.key),u=m+e.key,s?r(1,s,u):(t(".mask").hide(),t(".tel-mask").fadeIn())},error:function(e){console.log("失败:"+JSON.stringify(e))}}),!1}),t("#submit").click(function(){var e=t("#telephone").val().trim();localStorage.setItem("mobile",e),o.isMobile(e)&&r(1,e,u)}),t(".share-btn").click(function(){t(".weui_mask").fadeIn(),t.ajax({type:"GET",url:"http://"+a.apidomain+"/kangshifu/have-share?mobile="+s,data:{random:Math.random(),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){e.code},error:function(e){console.log("ajaxFailure")}})}),t(".weui_mask").click(function(){t(this).fadeOut()});var d={shareTitle:"康师傅绿茶！",shareUrl:window.location.href,shareImg:"http://kangshifu.qnmami.com/img/slogan.png",shareDes:"康师傅绿茶！"};n.initWxJs("wx8e56a8ebb0688ab9","pt_christmas",["onMenuShareTimeline","onMenuShareAppMessage"],function(){e.onMenuShareTimeline({title:d.shareTitle,link:d.shareUrl,imgUrl:d.shareImg,success:function(){},cancel:function(){}}),e.onMenuShareAppMessage({title:d.shareTitle,link:d.shareUrl,desc:d.shareDes,imgUrl:d.shareImg,type:"",dataUrl:"",success:function(){},cancel:function(){}})})})});