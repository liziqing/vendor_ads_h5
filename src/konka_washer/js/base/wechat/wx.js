define(["base/env","base/util","jquery","wx"],function(e,o,t,n){var a=function(t,n,a){if(1==e.local)return void a();var n=n||window.location.href,i=o.queryString("code");o.ajax({url:"http://"+e.domain+"/weixin/common/cookie-oauth-token-no-session",type:"get",data:{format:"jsonp"},dataType:"jsonp",success:function(c){0==c.code?""==c.data.access_token?void 0!=i&&null!=i?o.ajax({url:"http://"+e.domain+"/weixin/common/oauth-token-no-session",type:"get",data:{code:i,format:"jsonp"},dataType:"jsonp",success:function(e){0==e.code&&a(e.data)},error:function(){alert("数据读取失败")}}):window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t+"&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_base&state=weiapppay#wechat_redirect":a(c.data):window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t+"&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_base&state=weiapppay#wechat_redirect"}})},i=function(t,n,a){if(1==e.local)return void a();var n=n||window.location.href,i=o.queryString("code");o.ajax({url:"http://"+e.domain+"/weixin/common/cookie-oauth-token",type:"get",data:{format:"jsonp"},dataType:"jsonp",success:function(c){0==c.code?""==c.data.access_token?void 0!=i&&null!=i?o.ajax({url:"http://"+e.domain+"/weixin/common/oauth-token",type:"get",data:{code:i,format:"jsonp"},dataType:"jsonp",success:function(e){0==e.code&&a(e.data)},error:function(){alert("数据读取失败")}}):window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t+"&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_base&state=weiapppay#wechat_redirect":a(c.data):window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t+"&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_base&state=weiapppay#wechat_redirect"}})},c=function(t,a,i){o.ajax({type:"GET",url:"http://"+e.domain+"/weixin/common/sig",data:{url:encodeURIComponent(window.location.href),format:"jsonp"},dataType:"jsonp",jsonp:"callback",success:function(e){var o=e.data.timestamp,c=e.data.nonceStr,p=e.data.signature;n.config({debug:!1,appId:t,timestamp:o,nonceStr:c,signature:p,jsApiList:a}),n.ready(function(){"undefined"!=typeof i&&i()})}})};return{initToken:i,initWxJs:c,initTokenNoSession:a}});